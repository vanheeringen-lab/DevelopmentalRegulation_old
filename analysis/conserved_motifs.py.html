
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Cross-species conservation of motifs &#8212; Developmental Conservation</title>
    
  <link rel="stylesheet" href="../_static/css/index.d431a4ee1c1efae0e38bdfebc22debff.css">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      
  <link rel="stylesheet"
    href="../_static/vendor/open-sans_all/1.44.1/index.css">
  <link rel="stylesheet"
    href="../_static/vendor/lato_latin-ext/1.44.1/index.css">

    
    <link rel="stylesheet" href="../_static/sphinx-book-theme.bfb7730f9caf2ec0b46a44615585038c.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../_static/js/index.30270b6e4c972e43c488.js">

    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/language_data.js"></script>
    <script src="../_static/togglebutton.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/sphinx-book-theme.be0a4a0c39cd630af62a2fcf693f3f06.js"></script>
    <script async="async" src="https://unpkg.com/thebelab@latest/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <link rel="shortcut icon" href="../_static/logo.png"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Cell contribution" href="relative_cell.py.html" />
    <link rel="prev" title="Principal Component Analysis of “differential” peaks" href="pcas.py.html" />

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />



  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
<a class="navbar-brand text-wrap" href="../index.html">
  
  <img src="../_static/logo.png" class="logo" alt="logo">
  
  
  <h1 class="site-logo" id="site-title">Developmental Conservation</h1>
  
</a>
</div>

<form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form>

<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  <ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../docs/introduction.html">
   Developmental regulation
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Preprocessing
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../docs/seq2science.html">
   Preprocessing with seq2science
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../docs/qcreports.py.html">
   QC reports
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Analysis
 </span>
</p>
<ul class="current nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="differential_peaks.py.html">
   Differential peak selection
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="gimme_maelstrom.py.html">
   gimme maelstrom
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="kmediods.py.html">
   Kmediods of peaks
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="pcas.py.html">
   Principal Component Analysis of “differential” peaks
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Cross-species conservation of motifs
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="relative_cell.py.html">
   Cell contribution
  </a>
 </li>
</ul>

</nav>

 <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="row topbar fixed-top container-xl">
    <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show">
    </div>
    <div class="col pl-2 topbar-main">
        
        <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
            data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
            aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
            title="Toggle navigation" data-toggle="tooltip" data-placement="left">
            <i class="fas fa-bars"></i>
            <i class="fas fa-arrow-left"></i>
            <i class="fas fa-arrow-up"></i>
        </button>
        
        <div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    
    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../_sources/analysis/conserved_motifs.py.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
    
</div>
        <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/vanheeringen-lab/DevelopmentalBiology"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/vanheeringen-lab/DevelopmentalBiology/issues/new?title=Issue%20on%20page%20%2Fanalysis/conserved_motifs.py.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        <a class="edit-button" href="https://github.com/vanheeringen-lab/DevelopmentalBiology/edit/master/analysis/conserved_motifs.py.ipynb"><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Edit this page"><i class="fas fa-pencil-alt"></i>suggest edit</button></a>
    </div>
</div>


        <!-- Full screen (wrap in <a> to have style consistency -->
        <a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
                data-placement="bottom" onclick="toggleFullScreen()" title="Fullscreen mode"><i
                    class="fas fa-expand"></i></button></a>

        <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/vanheeringen-lab/DevelopmentalBiology/master?urlpath=tree/analysis/conserved_motifs.py.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="../_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        <a class="colab-button" href="https://colab.research.google.com/github/vanheeringen-lab/DevelopmentalBiology/blob/master/analysis/conserved_motifs.py.ipynb"><button type="button" class="btn btn-secondary topbarbtn"
                title="Launch Colab" data-toggle="tooltip" data-placement="left"><img class="colab-button-logo"
                    src="../_static/images/logo_colab.png"
                    alt="Interact on Colab">Colab</button></a>
        
        
    </div>
</div>

    </div>

    <!-- Table of contents -->
    <div class="d-none d-md-block col-md-2 bd-toc show">
        
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="cross-species-conservation-of-motifs">
<h1>Cross-species conservation of motifs<a class="headerlink" href="#cross-species-conservation-of-motifs" title="Permalink to this headline">¶</a></h1>
<p>I should write a nice summary and introduction here.</p>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># import everything</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">itertools</span>

<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">mpl_toolkits.axes_grid1</span> <span class="kn">import</span> <span class="n">make_axes_locatable</span>
<span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">zscore</span>
<span class="kn">import</span> <span class="nn">gimmemotifs</span> <span class="k">as</span> <span class="nn">gimme</span>
<span class="kn">from</span> <span class="nn">gimmemotifs.motif</span> <span class="kn">import</span> <span class="n">read_motifs</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">silhouette_score</span>
<span class="kn">from</span> <span class="nn">sklearn.decomposition</span> <span class="kn">import</span> <span class="n">PCA</span>
<span class="kn">from</span> <span class="nn">sklearn.cluster</span> <span class="kn">import</span> <span class="n">FeatureAgglomeration</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics.cluster</span> <span class="kn">import</span> <span class="n">homogeneity_score</span>


<span class="kn">import</span> <span class="nn">util</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2020-10-02 19:14:18,883 - INFO - No config found.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2020-10-02 19:14:18,884 - INFO - Creating new config.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2020-10-02 19:14:18,886 - INFO - Using included version of MDmodule.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2020-10-02 19:14:19,204 - INFO - Using system version of MEME.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2020-10-02 19:14:19,301 - INFO - Using system version of MEMEW.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2020-10-02 19:14:19,481 - WARNING - DREME not found. To include it you will have to install it.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2020-10-02 19:14:19,581 - INFO - Using system version of Weeder.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2020-10-02 19:14:19,679 - INFO - Using system version of GADEM.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2020-10-02 19:14:19,681 - INFO - Using included version of MotifSampler.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2020-10-02 19:14:19,778 - INFO - Using system version of Trawler.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2020-10-02 19:14:19,780 - INFO - Using included version of Improbizer.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2020-10-02 19:14:19,782 - INFO - Using included version of BioProspector.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2020-10-02 19:14:19,783 - INFO - Using included version of Posmo.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2020-10-02 19:14:19,783 - INFO - Using included version of ChIPMunk.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2020-10-02 19:14:19,784 - INFO - Using included version of AMD.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2020-10-02 19:14:19,785 - INFO - Using included version of HMS.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2020-10-02 19:14:19,878 - INFO - Using system version of Homer.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2020-10-02 19:14:19,972 - INFO - Using system version of XXmotif.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2020-10-02 19:14:20,073 - INFO - Using system version of ProSampler.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2020-10-02 19:14:20,075 - WARNING - Yamda not in config
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2020-10-02 19:14:20,169 - INFO - Using system version of DiNAMO.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2020-10-02 19:14:20,347 - WARNING - RPMCMC not found. To include it you will have to install it.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2020-10-02 19:14:20,349 - INFO - Configuration file: /home/runner/.config/gimmemotifs/gimmemotifs.cfg
</pre></div>
</div>
</div>
</div>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># make sure to work with the correct assemblies</span>
<span class="k">if</span> <span class="s1">&#39;snakemake&#39;</span> <span class="ow">in</span> <span class="nb">globals</span><span class="p">():</span>
    <span class="n">assemblies</span> <span class="o">=</span> <span class="n">snakemake</span><span class="o">.</span><span class="n">params</span>
<span class="k">else</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">glob</span>
    <span class="n">assemblies</span> <span class="o">=</span> <span class="p">[</span><span class="n">assemblydir</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">assemblydir</span> <span class="ow">in</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s2">&quot;gimme_smooth/**/activity.bayesianridge.score.out.txt&quot;</span><span class="p">)]</span>

<span class="c1"># assemblies = [&quot;danRer11&quot;, &quot;xenTro9&quot;]</span>
<span class="c1"># load the assemblies as dataframes</span>
<span class="n">dfs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
<span class="k">for</span> <span class="n">assembly</span> <span class="ow">in</span> <span class="n">assemblies</span><span class="p">:</span> 
    <span class="n">dfs</span><span class="p">[</span><span class="n">assembly</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;gimme_smooth/</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">/activity.bayesianridge.score.out.txt&quot;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">comment</span><span class="o">=</span><span class="s2">&quot;#&quot;</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fix</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">15</span><span class="p">))</span>

<span class="n">df1</span> <span class="o">=</span> <span class="n">dfs</span><span class="p">[</span><span class="s2">&quot;mm10&quot;</span><span class="p">]</span>
<span class="n">df2</span> <span class="o">=</span> <span class="n">dfs</span><span class="p">[</span><span class="s2">&quot;mm10&quot;</span><span class="p">]</span>
<span class="n">corr</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">df1</span><span class="p">,</span> <span class="n">df2</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">keys</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;df1&#39;</span><span class="p">,</span> <span class="s1">&#39;df2&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">corr</span><span class="p">()</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;df2&#39;</span><span class="p">,</span> <span class="s1">&#39;df1&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">T</span>
<span class="o">*</span><span class="n">outline</span><span class="p">,</span> <span class="n">maxima</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">get_outline</span><span class="p">(</span><span class="n">corr</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">maxima</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="o">*</span><span class="n">outline</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="o">.</span><span class="mi">5</span><span class="p">),</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">matshow</span><span class="p">(</span><span class="n">corr</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
<span class="k">for</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">),</span> <span class="n">z</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">ndenumerate</span><span class="p">(</span><span class="n">corr</span><span class="o">.</span><span class="n">values</span><span class="p">):</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">{:0.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">z</span><span class="p">),</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>21
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nr_assemblies</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">dfs</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mi">30</span><span class="p">),</span> <span class="n">nrows</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">dfs</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span> <span class="n">ncols</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">dfs</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
<span class="c1"># fig, axes = plt.subplots(figsize=(15, 15), nrows=len(dfs.keys()), ncols=len(dfs.keys()))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">wspace</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">hspace</span><span class="o">=</span><span class="mf">0.05</span><span class="p">)</span>

<span class="n">early</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">dfs</span><span class="p">[</span><span class="s2">&quot;danRer11&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
<span class="n">late</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">dfs</span><span class="p">[</span><span class="s2">&quot;danRer11&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">get_bars</span><span class="p">(</span><span class="n">assembly</span><span class="p">):</span>
    <span class="n">bars</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">phase</span><span class="p">,</span> <span class="n">color</span> <span class="ow">in</span> <span class="n">colors</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">start</span> <span class="o">=</span> <span class="n">timings</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">assembly</span><span class="p">,</span> <span class="n">phase</span><span class="p">]</span>
        <span class="n">col_idx</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">timings</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">phase</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">col_idx</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">end_col</span> <span class="ow">in</span> <span class="n">timings</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="n">col_idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:]:</span>
                <span class="n">end</span> <span class="o">=</span> <span class="n">timings</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">assembly</span><span class="p">,</span> <span class="n">end_col</span><span class="p">]</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">end</span><span class="p">):</span>
                    <span class="n">bars</span><span class="p">[</span><span class="n">phase</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">color</span><span class="p">)</span>
                    <span class="k">break</span>
    <span class="k">return</span> <span class="n">bars</span>

<span class="k">for</span> <span class="n">assembly_1_i</span><span class="p">,</span> <span class="n">assembly_1</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">dfs</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
    <span class="k">for</span> <span class="n">assembly_2_i</span><span class="p">,</span> <span class="n">assembly_2</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">dfs</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="n">assembly_1_i</span><span class="p">,</span> <span class="n">assembly_2_i</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">assembly_2_i</span> <span class="o">&gt;</span> <span class="n">assembly_1_i</span><span class="p">:</span> 
            <span class="n">ax</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
            <span class="k">continue</span>
        <span class="n">df1</span> <span class="o">=</span> <span class="n">dfs</span><span class="p">[</span><span class="n">assembly_1</span><span class="p">]</span>
        <span class="n">df2</span> <span class="o">=</span> <span class="n">dfs</span><span class="p">[</span><span class="n">assembly_2</span><span class="p">]</span>
        <span class="n">corr</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">df1</span><span class="p">,</span> <span class="n">df2</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">keys</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;df1&#39;</span><span class="p">,</span> <span class="s1">&#39;df2&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">corr</span><span class="p">()</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;df2&#39;</span><span class="p">,</span> <span class="s1">&#39;df1&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">T</span>

        <span class="k">if</span> <span class="n">assembly_1</span> <span class="o">==</span> <span class="n">assembly_2</span><span class="p">:</span>
            <span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span>
            <span class="n">cmap</span> <span class="o">=</span> <span class="s2">&quot;Blues&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">0.25</span>
            <span class="n">cmap</span> <span class="o">=</span> <span class="s2">&quot;pink_r&quot;</span>
                
        <span class="n">im</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">matshow</span><span class="p">(</span><span class="n">corr</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">df2</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">df1</span><span class="o">.</span><span class="n">columns</span><span class="p">),</span> <span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">assembly_1</span> <span class="o">!=</span> <span class="n">assembly_2</span><span class="p">:</span>
            <span class="o">*</span><span class="n">outline</span><span class="p">,</span> <span class="n">maxima</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">get_outline</span><span class="p">(</span><span class="n">corr</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="o">*</span><span class="n">outline</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="o">.</span><span class="mi">5</span><span class="p">),</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">maxima</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">time_1_1</span><span class="p">,</span> <span class="n">time_1_2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">maxima</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">time_2_1</span><span class="p">,</span> <span class="n">time_2_2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">maxima</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
                
<span class="c1">#                 df_tmp[:] = zscore(df_tmp, axis=0)</span>
                <span class="n">df_early</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">df1</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="n">time_1_1</span><span class="p">],</span> <span class="n">df2</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="n">time_2_1</span><span class="p">]],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">df_early</span><span class="p">[</span><span class="s2">&quot;average&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">df_early</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">early</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">assembly_1</span><span class="si">}</span><span class="s2"> &amp; </span><span class="si">{</span><span class="n">assembly_2</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_early</span><span class="p">[</span><span class="s2">&quot;average&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">rank</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;average&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

                <span class="n">df_late</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">df1</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="n">time_1_2</span><span class="p">],</span> <span class="n">df2</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="n">time_2_2</span><span class="p">]],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">df_late</span><span class="p">[</span><span class="s2">&quot;average&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">df_late</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">late</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">assembly_1</span><span class="si">}</span><span class="s2"> &amp; </span><span class="si">{</span><span class="n">assembly_2</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_late</span><span class="p">[</span><span class="s2">&quot;average&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">rank</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;average&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">([])</span>
        <span class="k">if</span> <span class="n">assembly_2_i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<span class="c1">#             ax.set_yticks(range(corr.shape[0]), minor=False)</span>
<span class="c1">#             ax.set_yticklabels(corr.index, fontsize=14)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">util</span><span class="o">.</span><span class="n">ass2name</span><span class="p">(</span><span class="n">assembly_1</span><span class="p">),</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
            
<span class="c1">#             for start, stop, color in get_bars(assembly_1).values():</span>
<span class="c1">#                 p_start = float(corr.index[0])</span>
<span class="c1">#                 p_stop = float(corr.index[-1])</span>
<span class="c1">#                 stop  = list(sorted([0, 1, (stop - p_start) / (p_stop - p_start)]))[1]</span>
<span class="c1">#                 start = list(sorted([0, 1, (start  - p_start) / (p_stop - p_start)]))[1]</span>
<span class="c1">#                 add_bar_left(im, start, stop, color=color)</span>

        <span class="k">if</span> <span class="n">assembly_1_i</span> <span class="o">==</span> <span class="n">nr_assemblies</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">util</span><span class="o">.</span><span class="n">ass2name</span><span class="p">(</span><span class="n">assembly_2</span><span class="p">),</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
<span class="c1">#             ax.set_xticks(range(corr.shape[1]), minor=False)</span>
<span class="c1">#             ax.set_xticklabels(corr.columns, fontsize=14)</span>
<span class="c1">#             ax.xaxis.set_ticks_position(&quot;bottom&quot;)</span>
<span class="c1">#             for start, stop, color in get_bars(assembly_2).values():</span>
<span class="c1">#                 p_start = float(corr.columns[0])</span>
<span class="c1">#                 p_stop = float(corr.columns[-1])</span>
<span class="c1">#                 stop  = list(sorted([0, 1, (stop - p_start) / (p_stop - p_start)]))[1]</span>
<span class="c1">#                 start = list(sorted([0, 1, (start  - p_start) / (p_stop - p_start)]))[1]</span>
<span class="c1">#                 add_bar_lower(im, start, stop, color=color)</span>
        
<span class="c1">#         # pretty colorbar</span>
<span class="c1">#         divider = make_axes_locatable(ax)</span>
<span class="c1">#         cax = divider.append_axes(&quot;right&quot;, size=&quot;5%&quot;, pad=0.1)</span>
<span class="c1">#         plt.colorbar(im, cax=cax)</span>

<span class="c1">#         ax.set_aspect(&#39;equal&#39;)</span>
<span class="c1"># fig.colorbar(im, ax=axes[0])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">early</span><span class="p">[</span><span class="s2">&quot;mean&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">early</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">late</span><span class="p">[</span><span class="s2">&quot;mean&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">late</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">early</span> <span class="o">=</span> <span class="n">early</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s2">&quot;mean&quot;</span><span class="p">)</span>
<span class="n">late</span> <span class="o">=</span> <span class="n">late</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s2">&quot;mean&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">IPython</span>
<span class="k">with</span> <span class="n">pd</span><span class="o">.</span><span class="n">option_context</span><span class="p">(</span><span class="s1">&#39;display.max_rows&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;display.max_columns&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">):</span>
    <span class="n">IPython</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">display</span><span class="p">(</span><span class="n">early</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s2">&quot;mean&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>ASM318616v1 &amp; mm10</th>
      <th>Astyanax_mexicanus-2.0 &amp; mm10</th>
      <th>Astyanax_mexicanus-2.0 &amp; ASM318616v1</th>
      <th>Bl71nemr &amp; mm10</th>
      <th>Bl71nemr &amp; ASM318616v1</th>
      <th>Bl71nemr &amp; Astyanax_mexicanus-2.0</th>
      <th>xenTro9 &amp; mm10</th>
      <th>xenTro9 &amp; ASM318616v1</th>
      <th>xenTro9 &amp; Astyanax_mexicanus-2.0</th>
      <th>xenTro9 &amp; Bl71nemr</th>
      <th>danRer11 &amp; ASM318616v1</th>
      <th>danRer11 &amp; Astyanax_mexicanus-2.0</th>
      <th>danRer11 &amp; Bl71nemr</th>
      <th>danRer11 &amp; xenTro9</th>
      <th>ASM223467v1 &amp; mm10</th>
      <th>ASM223467v1 &amp; ASM318616v1</th>
      <th>ASM223467v1 &amp; Astyanax_mexicanus-2.0</th>
      <th>ASM223467v1 &amp; Bl71nemr</th>
      <th>ASM223467v1 &amp; xenTro9</th>
      <th>ASM223467v1 &amp; danRer11</th>
      <th>GRCg6a &amp; mm10</th>
      <th>GRCg6a &amp; Astyanax_mexicanus-2.0</th>
      <th>GRCg6a &amp; Bl71nemr</th>
      <th>GRCg6a &amp; xenTro9</th>
      <th>GRCg6a &amp; ASM223467v1</th>
      <th>mean</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>GM.5.0.Sox.0028</th>
      <td>662.0</td>
      <td>11.0</td>
      <td>4.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>2.0</td>
      <td>205.0</td>
      <td>3.0</td>
      <td>2.0</td>
      <td>2.0</td>
      <td>6.0</td>
      <td>13.0</td>
      <td>9.0</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>2.0</td>
      <td>5.0</td>
      <td>1.0</td>
      <td>2.0</td>
      <td>5.0</td>
      <td>50.0</td>
      <td>4.0</td>
      <td>8.0</td>
      <td>7.0</td>
      <td>6.0</td>
      <td>40.80</td>
    </tr>
    <tr>
      <th>GM.5.0.Homeodomain_POU.0007</th>
      <td>85.0</td>
      <td>3.0</td>
      <td>2.0</td>
      <td>7.0</td>
      <td>2.0</td>
      <td>1.0</td>
      <td>63.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>3.0</td>
      <td>2.0</td>
      <td>2.0</td>
      <td>1.0</td>
      <td>26.0</td>
      <td>7.0</td>
      <td>2.0</td>
      <td>3.0</td>
      <td>1.0</td>
      <td>11.0</td>
      <td>479.0</td>
      <td>8.0</td>
      <td>252.0</td>
      <td>25.0</td>
      <td>49.0</td>
      <td>41.48</td>
    </tr>
    <tr>
      <th>GM.5.0.C2H2_ZF.0108</th>
      <td>149.0</td>
      <td>2.0</td>
      <td>1.0</td>
      <td>372.0</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>361.0</td>
      <td>6.0</td>
      <td>9.0</td>
      <td>10.0</td>
      <td>8.0</td>
      <td>29.0</td>
      <td>214.0</td>
      <td>22.0</td>
      <td>4.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>4.0</td>
      <td>6.0</td>
      <td>2.0</td>
      <td>101.0</td>
      <td>5.0</td>
      <td>146.0</td>
      <td>41.0</td>
      <td>5.0</td>
      <td>60.32</td>
    </tr>
    <tr>
      <th>GM.5.0.Homeodomain_POU.0022</th>
      <td>214.0</td>
      <td>97.0</td>
      <td>11.0</td>
      <td>63.0</td>
      <td>7.0</td>
      <td>7.0</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>18.0</td>
      <td>17.0</td>
      <td>7.0</td>
      <td>3.0</td>
      <td>21.0</td>
      <td>10.0</td>
      <td>10.0</td>
      <td>6.0</td>
      <td>4.0</td>
      <td>19.0</td>
      <td>305.0</td>
      <td>67.0</td>
      <td>585.0</td>
      <td>6.0</td>
      <td>46.0</td>
      <td>61.48</td>
    </tr>
    <tr>
      <th>GM.5.0.Homeodomain_POU.0020</th>
      <td>172.0</td>
      <td>9.0</td>
      <td>8.0</td>
      <td>57.0</td>
      <td>6.0</td>
      <td>4.0</td>
      <td>530.0</td>
      <td>7.0</td>
      <td>6.0</td>
      <td>5.0</td>
      <td>9.0</td>
      <td>7.0</td>
      <td>5.0</td>
      <td>6.0</td>
      <td>28.0</td>
      <td>13.0</td>
      <td>8.0</td>
      <td>9.0</td>
      <td>10.0</td>
      <td>15.0</td>
      <td>242.0</td>
      <td>28.0</td>
      <td>426.0</td>
      <td>119.0</td>
      <td>44.0</td>
      <td>70.92</td>
    </tr>
    <tr>
      <th>GM.5.0.Unknown.0094</th>
      <td>180.0</td>
      <td>57.0</td>
      <td>13.0</td>
      <td>646.0</td>
      <td>41.0</td>
      <td>97.0</td>
      <td>34.0</td>
      <td>15.0</td>
      <td>22.0</td>
      <td>55.0</td>
      <td>20.0</td>
      <td>51.0</td>
      <td>233.0</td>
      <td>33.0</td>
      <td>15.0</td>
      <td>9.0</td>
      <td>18.0</td>
      <td>38.0</td>
      <td>15.0</td>
      <td>28.0</td>
      <td>118.0</td>
      <td>40.0</td>
      <td>53.0</td>
      <td>17.0</td>
      <td>14.0</td>
      <td>74.48</td>
    </tr>
    <tr>
      <th>GM.5.0.C2H2_ZF_Homeodomain.0002</th>
      <td>19.0</td>
      <td>4.0</td>
      <td>10.0</td>
      <td>1099.0</td>
      <td>274.0</td>
      <td>24.0</td>
      <td>206.0</td>
      <td>12.0</td>
      <td>7.0</td>
      <td>18.0</td>
      <td>11.0</td>
      <td>3.0</td>
      <td>57.0</td>
      <td>7.0</td>
      <td>10.0</td>
      <td>11.0</td>
      <td>3.0</td>
      <td>20.0</td>
      <td>8.0</td>
      <td>3.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>144.0</td>
      <td>1.0</td>
      <td>2.0</td>
      <td>78.20</td>
    </tr>
    <tr>
      <th>GM.5.0.Sox.0023</th>
      <td>1068.0</td>
      <td>166.0</td>
      <td>70.0</td>
      <td>4.0</td>
      <td>31.0</td>
      <td>26.0</td>
      <td>240.0</td>
      <td>23.0</td>
      <td>32.0</td>
      <td>21.0</td>
      <td>83.0</td>
      <td>139.0</td>
      <td>104.0</td>
      <td>29.0</td>
      <td>9.0</td>
      <td>15.0</td>
      <td>22.0</td>
      <td>12.0</td>
      <td>17.0</td>
      <td>16.0</td>
      <td>58.0</td>
      <td>56.0</td>
      <td>12.0</td>
      <td>45.0</td>
      <td>10.0</td>
      <td>92.32</td>
    </tr>
    <tr>
      <th>GM.5.0.C2H2_ZF.0010</th>
      <td>38.0</td>
      <td>68.0</td>
      <td>38.0</td>
      <td>727.0</td>
      <td>155.0</td>
      <td>154.0</td>
      <td>151.0</td>
      <td>80.0</td>
      <td>61.0</td>
      <td>154.0</td>
      <td>33.0</td>
      <td>41.0</td>
      <td>118.0</td>
      <td>77.0</td>
      <td>7.0</td>
      <td>12.0</td>
      <td>11.0</td>
      <td>16.0</td>
      <td>22.0</td>
      <td>8.0</td>
      <td>39.0</td>
      <td>19.0</td>
      <td>290.0</td>
      <td>27.0</td>
      <td>7.0</td>
      <td>94.12</td>
    </tr>
    <tr>
      <th>GM.5.0.C2H2_ZF.0281</th>
      <td>75.0</td>
      <td>43.0</td>
      <td>22.0</td>
      <td>20.0</td>
      <td>24.0</td>
      <td>9.0</td>
      <td>576.0</td>
      <td>36.0</td>
      <td>23.0</td>
      <td>22.0</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>11.0</td>
      <td>12.0</td>
      <td>894.0</td>
      <td>322.0</td>
      <td>95.0</td>
      <td>129.0</td>
      <td>78.0</td>
      <td>44.0</td>
      <td>104.0</td>
      <td>24.0</td>
      <td>104.0</td>
      <td>72.0</td>
      <td>152.0</td>
      <td>115.96</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">IPython</span>
<span class="k">with</span> <span class="n">pd</span><span class="o">.</span><span class="n">option_context</span><span class="p">(</span><span class="s1">&#39;display.max_rows&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;display.max_columns&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">):</span>
    <span class="n">IPython</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">display</span><span class="p">(</span><span class="n">late</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s2">&quot;mean&quot;</span><span class="p">)[</span><span class="s2">&quot;mean&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>GM.5.0.C2H2_ZF.0097                    51.04
GM.5.0.Nuclear_receptor.0069          104.84
GM.5.0.RFX.0015                       110.88
GM.5.0.Nuclear_receptor.0140          135.80
GM.5.0.C2H2_ZF.0094                   139.84
GM.5.0.RFX.0006                       152.96
GM.5.0.Unknown.0065                   153.12
GM.5.0.Homeodomain_Paired_box.0002    155.88
GM.5.0.Unknown.0167                   163.28
GM.5.0.Homeodomain.0149               190.80
Name: mean, dtype: float64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">fake_bootstrap</span><span class="p">(</span><span class="n">nr_motifs</span><span class="p">,</span> <span class="n">nr_columns</span><span class="p">,</span> <span class="n">tries</span><span class="o">=</span><span class="mi">1_000</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">bootstrapped</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nr_motifs</span><span class="p">,</span> <span class="n">tries</span><span class="p">))</span>
    <span class="n">fake_ranks</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">rank</span> <span class="k">for</span> <span class="n">rank</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nr_motifs</span><span class="p">)]</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nr_columns</span><span class="p">)])</span><span class="o">.</span><span class="n">T</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">tries</span><span class="p">):</span>
        <span class="c1"># randomize our fake ranks</span>
        <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nr_columns</span><span class="p">):</span>
            <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">fake_ranks</span><span class="p">[:,</span> <span class="n">column</span><span class="p">])</span>

        <span class="n">bootstrapped</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="o">-</span><span class="n">fake_ranks</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">bootstrapped</span>

<span class="c1"># now bootstrap</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">fake_bootstrap</span><span class="p">(</span><span class="n">early</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">early</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">result_sorted</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">total_tries</span> <span class="o">=</span> <span class="n">result_sorted</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

<span class="n">ys_real</span> <span class="o">=</span> <span class="n">early</span><span class="p">[</span><span class="s2">&quot;mean&quot;</span><span class="p">]</span>
<span class="n">xs</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ys_real</span><span class="p">))]</span>


<span class="c1"># not really confidence interval, but comes close</span>
<span class="n">confidence_ish</span> <span class="o">=</span> <span class="mf">0.005</span><span class="p">,</span> <span class="mf">0.995</span>
<span class="n">confidence_ish</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">Figure</span><span class="p">()</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>


<span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> 
                <span class="n">result_sorted</span><span class="p">[:,</span> <span class="nb">int</span><span class="p">(</span><span class="n">total_tries</span> <span class="o">*</span> <span class="n">confidence_ish</span><span class="p">[</span><span class="mi">0</span><span class="p">])],</span> 
                <span class="n">result_sorted</span><span class="p">[:,</span> <span class="nb">int</span><span class="p">(</span><span class="n">total_tries</span> <span class="o">*</span> <span class="n">confidence_ish</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span> 
               <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">ys_real</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">xs</span><span class="p">)</span> <span class="o">-</span> <span class="mi">100</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.lines.Line2D at 0x7f7d0148beb0&gt;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">gimmemotifs.c_metrics</span> <span class="kn">import</span> <span class="n">pfmscan</span><span class="p">,</span> <span class="n">score</span>
<span class="kn">from</span> <span class="nn">gimmemotifs.comparison</span> <span class="kn">import</span> <span class="n">RCDB</span>
<span class="n">motifs</span> <span class="o">=</span> <span class="n">read_motifs</span><span class="p">()</span>

<span class="n">motif_scores</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
<span class="k">for</span> <span class="n">motif</span> <span class="ow">in</span> <span class="n">motifs</span><span class="p">:</span>
    <span class="n">motif_scores</span><span class="p">[</span><span class="n">motif</span><span class="p">]</span> <span class="o">=</span> <span class="n">pfmscan</span><span class="p">(</span><span class="n">RCDB</span><span class="p">,</span> <span class="n">motif</span><span class="o">.</span><span class="n">pwm</span><span class="p">,</span> <span class="n">motif</span><span class="o">.</span><span class="n">pwm_min_score</span><span class="p">(),</span> <span class="nb">len</span><span class="p">(</span><span class="n">RCDB</span><span class="p">),</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># pd.DataFrame.from_dict(motifs)</span>
<span class="c1"># motif_scores[&quot;GM.5.0.Sox.0001_AACAAT&quot;]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">motif_scores</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;ipython-input-12-503166603521&gt;:1: VisibleDeprecationWarning: Creating an ndarray from ragged nested sequences (which is a list-or-tuple of lists-or-tuples-or ndarrays with different lengths or shapes) is deprecated. If you meant to do this, you must specify &#39;dtype=object&#39; when creating the ndarray
  arr = np.array(list(motif_scores.values()))
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">arr</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(1796,)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">motif_scores</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>8187
8182
8182
8174
8185
8179
8188
8178
8183
8177
8181
8182
8187
8187
8186
8181
8182
8174
8182
8181
8169
8183
8181
8187
8183
8185
8188
8180
8185
8180
8182
8183
8184
8187
8184
8185
8184
8184
8180
8182
8183
8183
8176
8184
8183
8177
8186
8187
8186
8186
8184
8180
8185
8183
8172
8179
8184
8186
8184
8188
8176
8185
8185
8179
8182
8184
8186
8185
8182
8185
8186
8186
8180
8182
8186
8178
8184
8185
8186
8185
8179
8187
8184
8187
8185
8182
8183
8183
8187
8180
8179
8183
8178
8186
8182
8183
8185
8179
8173
8185
8185
8183
8181
8182
8185
8184
8183
8183
8177
8179
8185
8184
8180
8187
8186
8184
8174
8178
8184
8189
8178
8185
8183
8184
8179
8167
8172
8188
8184
8183
8187
8187
8187
8186
8185
8180
8182
8180
8183
8187
8178
8186
8182
8187
8175
8172
8184
8184
8187
8179
8185
8185
8183
8185
8185
8182
8187
8185
8184
8185
8188
8179
8186
8183
8180
8184
8184
8176
8173
8187
8185
8187
8176
8188
8186
8183
8181
8185
8187
8184
8187
8179
8183
8165
8184
8180
8182
8188
8184
8184
8173
8184
8187
8179
8185
8187
8172
8180
8188
8185
8180
8185
8186
8175
8185
8178
8186
8184
8188
8186
8184
8187
8183
8183
8178
8187
8187
8186
8186
8186
8176
8168
8186
8183
8177
8184
8180
8185
8183
8184
8183
8177
8183
8186
8183
8185
8184
8183
8182
8171
8180
8185
8179
8175
8188
8186
8185
8184
8169
8179
8176
8186
8182
8180
8181
8169
8177
8178
8184
8184
8180
8181
8177
8186
8178
8182
8178
8171
8183
8179
8178
8181
8183
8183
8175
8178
8187
8184
8176
8182
8184
8187
8184
8184
8179
8182
8178
8181
8186
8181
8186
8182
8182
8184
8184
8178
8185
8180
8183
8185
8176
8184
8183
8179
8184
8183
8185
8179
8176
8185
8180
8182
8180
8185
8182
8187
8184
8182
8177
8187
8183
8171
8185
8183
8181
8187
8178
8182
8170
8176
8183
8184
8178
8186
8179
8176
8184
8187
8178
8183
8188
8186
8177
8180
8186
8180
8184
8185
8182
8167
8187
8187
8183
8187
8181
8163
8174
8181
8187
8187
8185
8181
8178
8187
8183
8185
8182
8185
8176
8182
8185
8187
8184
8184
8181
8183
8179
8187
8179
8185
8183
8183
8184
8179
8183
8185
8182
8185
8183
8183
8187
8176
8180
8183
8180
8181
8169
8186
8185
8184
8186
8182
8180
8185
8180
8186
8182
8186
8187
8187
8183
8178
8183
8186
8178
8185
8183
8181
8180
8182
8184
8180
8181
8181
8177
8178
8180
8182
8186
8179
8181
8174
8184
8179
8185
8180
8187
8186
8183
8181
8188
8188
8183
8185
8185
8171
8186
8168
8182
8181
8179
8178
8178
8179
8178
8183
8174
8176
8178
8186
8175
8163
8182
8173
8176
8187
8177
8174
8181
8174
8168
8178
8183
8181
8183
8174
8166
8178
8184
8182
8188
8180
8177
8182
8184
8183
8176
8180
8187
8179
8183
8178
8182
8185
8184
8170
8173
8181
8181
8169
8176
8183
8177
8174
8174
8177
8186
8180
8186
8183
8184
8175
8183
8187
8176
8185
8172
8186
8183
8184
8177
8184
8163
8185
8186
8187
8172
8181
8187
8185
8184
8183
8187
8185
8186
8184
8176
8179
8183
8178
8176
8184
8170
8182
8181
8179
8176
8181
8173
8185
8185
8180
8179
8187
8186
8186
8183
8165
8183
8186
8179
8172
8188
8187
8185
8185
8175
8181
8184
8184
8182
8188
8187
8183
8174
8178
8163
8184
8185
8184
8164
8182
8185
8183
8178
8176
8170
8182
8186
8187
8178
8178
8184
8180
8184
8185
8169
8185
8183
8180
8185
8185
8183
8184
8185
8179
8178
8185
8185
8183
8179
8182
8185
8182
8178
8177
8174
8175
8184
8163
8177
8187
8186
8186
8186
8180
8178
8187
8187
8186
8183
8183
8182
8183
8185
8178
8171
8179
8186
8182
8185
8179
8184
8186
8185
8177
8187
8182
8184
8180
8182
8187
8182
8171
8177
8171
8185
8183
8185
8185
8185
8178
8184
8182
8185
8182
8175
8181
8175
8186
8172
8184
8181
8185
8183
8178
8178
8182
8183
8173
8183
8181
8185
8185
8182
8184
8182
8185
8181
8178
8185
8178
8187
8185
8183
8184
8187
8182
8180
8183
8169
8185
8185
8179
8180
8183
8188
8178
8187
8174
8186
8180
8183
8179
8183
8174
8183
8179
8182
8178
8175
8175
8176
8185
8186
8182
8175
8183
8184
8183
8184
8184
8181
8180
8185
8185
8185
8184
8180
8185
8182
8184
8182
8185
8181
8178
8174
8178
8185
8182
8178
8177
8183
8178
8174
8180
8172
8182
8181
8183
8186
8185
8184
8184
8188
8186
8164
8185
8185
8184
8179
8181
8188
8183
8177
8186
8187
8187
8182
8189
8188
8178
8185
8185
8187
8183
8180
8175
8187
8182
8184
8184
8175
8185
8178
8183
8183
8181
8183
8176
8173
8181
8165
8187
8184
8187
8172
8178
8179
8186
8183
8187
8184
8182
8176
8185
8187
8176
8177
8183
8182
8175
8183
8185
8179
8184
8183
8187
8176
8183
8185
8178
8172
8182
8180
8176
8183
8179
8184
8188
8185
8183
8181
8184
8178
8184
8174
8180
8185
8186
8183
8183
8183
8176
8190
8185
8184
8178
8174
8186
8178
8164
8186
8164
8178
8185
8172
8178
8184
8178
8184
8177
8183
8178
8184
8180
8188
8185
8175
8180
8184
8175
8181
8188
8183
8185
8184
8173
8178
8186
8182
8186
8184
8187
8185
8186
8178
8186
8183
8183
8164
8164
8175
8187
8179
8180
8173
8182
8184
8178
8163
8173
8182
8188
8184
8179
8187
8182
8165
8181
8174
8176
8172
8183
8178
8175
8185
8173
8185
8173
8185
8172
8172
8181
8185
8179
8178
8176
8178
8178
8184
8186
8163
8176
8175
8174
8181
8176
8177
8176
8180
8172
8186
8173
8169
8171
8177
8179
8185
8180
8176
8179
8181
8186
8181
8178
8178
8181
8183
8164
8181
8186
8180
8182
8180
8182
8177
8185
8185
8179
8175
8179
8182
8184
8164
8182
8186
8185
8176
8185
8175
8179
8166
8185
8185
8186
8183
8182
8177
8185
8163
8184
8183
8181
8178
8183
8172
8180
8184
8175
8176
8186
8183
8186
8180
8182
8189
8174
8170
8172
8177
8179
8184
8176
8174
8181
8179
8182
8180
8176
8183
8184
8183
8178
8185
8178
8183
8185
8185
8165
8163
8181
8172
8177
8175
8185
8184
8185
8180
8186
8163
8189
8179
8180
8175
8182
8174
8183
8183
8175
8186
8178
8181
8171
8183
8179
8172
8183
8177
8180
8164
8185
8178
8185
8185
8184
8186
8182
8172
8187
8186
8177
8179
8183
8177
8179
8163
8184
8179
8179
8186
8183
8163
8178
8186
8177
8185
8187
8186
8172
8164
8163
8185
8187
8183
8182
8171
8179
8178
8185
8180
8177
8166
8183
8178
8179
8179
8181
8189
8181
8178
8186
8183
8182
8165
8185
8169
8177
8176
8182
8182
8185
8170
8184
8179
8181
8172
8180
8180
8180
8168
8183
8177
8173
8180
8178
8174
8181
8163
8179
8180
8172
8184
8183
8188
8178
8163
8185
8184
8181
8183
8183
8185
8186
8185
8179
8184
8184
8181
8187
8184
8175
8185
8189
8182
8184
8180
8186
8180
8184
8181
8177
8182
8182
8181
8172
8163
8183
8183
8177
8186
8185
8184
8187
8185
8183
8179
8184
8182
8186
8179
8183
8173
8164
8185
8178
8184
8185
8187
8185
8179
8187
8190
8176
8181
8164
8181
8182
8184
8178
8185
8181
8186
8177
8165
8181
8178
8163
8180
8184
8181
8172
8181
8180
8184
8184
8178
8176
8174
8183
8172
8185
8180
8172
8181
8181
8183
8165
8179
8165
8177
8185
8182
8180
8176
8185
8181
8183
8172
8172
8177
8187
8185
8177
8177
8178
8189
8184
8178
8172
8183
8179
8186
8172
8186
8178
8178
8180
8173
8163
8183
8175
8182
8181
8179
8182
8187
8173
8181
8178
8178
8180
8180
8185
8179
8176
8164
8182
8184
8183
8173
8175
8184
8180
8181
8187
8179
8185
8173
8179
8180
8168
8178
8183
8185
8184
8178
8187
8184
8185
8174
8184
8173
8183
8180
8176
8185
8182
8183
8184
8182
8164
8187
8185
8163
8183
8185
8181
8178
8182
8185
8177
8176
8182
8177
8172
8166
8182
8178
8183
8163
8165
8179
8179
8184
8177
8183
8186
8179
8178
8179
8184
8174
8176
8187
8187
8187
8186
8181
8165
8175
8183
8165
8178
8179
8183
8178
8183
8177
8174
8183
8177
8185
8179
8180
8181
8185
8175
8185
8176
8179
8178
8174
8182
8181
8173
8163
8183
8180
8183
8180
8181
8184
8180
8185
8183
8173
8180
8179
8179
8172
8173
8176
8184
8183
8185
8185
8185
8184
8173
8178
8186
8173
8184
8180
8184
8175
8185
8185
8185
8186
8182
8184
8173
8172
8179
8173
8180
8176
8180
8183
8185
8183
8169
8187
8179
8186
8185
8183
8186
8184
8173
8181
8183
8180
8187
8163
8182
8184
8182
8185
8183
8179
8185
8178
8185
8182
8179
8185
8179
8185
8163
8184
8183
8186
8184
8179
8173
8183
8185
8182
8177
8186
8188
8175
8181
8174
8177
8180
8176
8188
8184
8179
8179
8178
8183
8180
8185
8184
8185
8185
8183
8180
8185
8184
8182
8187
8184
8183
8180
8163
8177
8183
8185
8180
8179
8163
8187
8179
8181
8179
8183
8181
8174
8175
8185
8184
8184
8181
8184
8183
8174
8188
8168
8183
8186
8180
8187
8178
8181
8185
8185
8178
8173
8188
8172
8183
8183
8183
8182
8176
8172
8184
8183
8184
8172
8183
8184
8183
8173
8185
8163
8182
8183
8183
8185
8182
8186
8177
8184
8183
8185
8180
8176
8184
8174
8183
8180
8185
8175
8181
8185
8182
8179
8176
8163
8179
8163
8178
8185
8184
8190
8179
8182
8182
8183
8178
8174
8183
8169
8183
8179
8180
8180
8180
8173
8170
8181
8184
8185
8184
8186
8186
8183
8180
8185
8182
8185
8186
8184
8183
8185
8183
8180
8181
8177
8178
8181
8179
8182
8185
8186
8179
8184
8186
8181
8181
8164
8182
8184
8184
8182
8186
8183
8178
8175
8180
8183
8179
8187
8185
8183
8184
8180
8184
8189
8179
8182
8184
8186
8180
8178
8182
8174
8179
8183
8168
8184
8185
8184
8179
8172
8183
8183
8171
8178
8178
8179
8178
8183
8186
8180
8165
8186
8182
8185
8183
8173
8175
8169
8163
8183
8176
8173
8178
8183
8181
8164
8164
8186
8184
8185
8179
8189
8185
8183
8180
8179
8185
8183
8180
8188
8183
8183
8179
8182
8176
8185
8180
8181
8179
8182
8185
8182
8177
8179
8177
8182
8183
8181
8181
8182
8184
8184
8188
8183
8172
8178
8182
8178
8187
8163
8177
8179
8164
8184
8173
8184
8185
8185
8184
8179
8180
8179
8164
8187
8178
8183
8186
8179
8184
8178
8172
8182
8182
8186
8183
8179
8176
8177
8185
8186
8182
8176
8178
8184
8185
8183
8185
8186
8163
8186
8181
8179
8163
8185
8181
8179
8183
8178
8181
8180
8182
8178
8181
8181
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># load the assemblies as dataframes</span>
<span class="n">dfs_scores</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
<span class="k">for</span> <span class="n">assembly</span> <span class="ow">in</span> <span class="n">assemblies</span><span class="p">:</span> 
    <span class="n">dfs</span><span class="p">[</span><span class="n">assembly</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;gimme_smooth/</span><span class="si">{</span><span class="n">assembly</span><span class="si">}</span><span class="s2">/motif.score.txt.gz&quot;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">comment</span><span class="o">=</span><span class="s2">&quot;#&quot;</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">compression</span><span class="o">=</span><span class="s1">&#39;gzip&#39;</span><span class="p">)</span>

<span class="n">all_scores</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">dfs</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># # get the labels</span>
<span class="c1"># dbd_re = &quot;(?:GM\.5\.0\.)(.+)(?:\.\d{4}.*)&quot;</span>
<span class="c1"># true_groups = [re.search(dbd_re, motif.__str__()).group(1) for motif in motifs]</span>
<span class="c1"># group2label = {group: i for i, group in enumerate(set(true_groups))}</span>
<span class="c1"># true_labels = [group2label[re.search(dbd_re, group).group(1)] for group in all_scores.columns]</span>

<span class="c1"># p = PCA(n_components=100)</span>
<span class="c1"># pcs = pd.DataFrame(p.fit_transform(all_scores.T), index=all_scores.columns)</span>
<span class="c1"># # xs = list(range(3, len(all_scores.columns) - 1))</span>
<span class="c1"># xs = np.linspace(len(group2label), len(all_scores.columns) - 1, 100)</span>
<span class="c1"># ys = {</span>
<span class="c1">#     &quot;FeatureAgglomeration&quot;: [],</span>
<span class="c1">#     &quot;&quot;</span>
<span class="c1"># }</span>
<span class="c1"># homogeneity_scores = []</span>
<span class="c1"># for x in xs:</span>
<span class="c1">#     x = int(x)</span>
<span class="c1">#     fa = FeatureAgglomeration(</span>
<span class="c1">#                 n_clusters=x, affinity=&quot;euclidean&quot;, linkage=&quot;complete&quot;,</span>
<span class="c1">#     )</span>
<span class="c1">#     fa.fit(pcs.T)</span>
<span class="c1">#     homogen_score = homogeneity_score(true_labels, fa.labels_)</span>
<span class="c1">#     homogeneity_scores.append(homogen_score)</span>
<span class="c1">#     sil_score = silhouette_score(all_scores.T, fa.labels_)</span>
<span class="c1">#     ys.append(sil_score)</span>
    
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># print(sil_score)</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">ys</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">ys</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">ys</span><span class="p">)))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">xs</span><span class="p">[</span><span class="n">ys</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">ys</span><span class="p">))])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="o">&lt;</span><span class="n">ipython</span><span class="o">-</span><span class="nb">input</span><span class="o">-</span><span class="mi">17</span><span class="o">-</span><span class="n">c3d4fbb1e4e1</span><span class="o">&gt;</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="c1"># print(sil_score)</span>
<span class="ne">----&gt; </span><span class="mi">2</span> <span class="nb">print</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">ys</span><span class="p">))</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span> <span class="nb">print</span><span class="p">(</span><span class="n">ys</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">ys</span><span class="p">)))</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span> <span class="nb">print</span><span class="p">(</span><span class="n">xs</span><span class="p">[</span><span class="n">ys</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">ys</span><span class="p">))])</span>

<span class="ne">NameError</span>: name &#39;ys&#39; is not defined
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># plt.plot(xs, ys)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">homogeneity_scores</span><span class="p">)</span>
<span class="c1"># plt.axvline(xs[ys.index(max(ys))])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">ys</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ys</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">homogeneity_scores</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nr_clusters</span> <span class="o">=</span> <span class="mi">600</span>

<span class="n">p</span> <span class="o">=</span> <span class="n">PCA</span><span class="p">(</span><span class="n">n_components</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
<span class="n">pcs</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">all_scores</span><span class="o">.</span><span class="n">T</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="n">all_scores</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
<span class="n">fa</span> <span class="o">=</span> <span class="n">FeatureAgglomeration</span><span class="p">(</span>
            <span class="n">n_clusters</span><span class="o">=</span><span class="n">nr_clusters</span><span class="p">,</span> <span class="n">affinity</span><span class="o">=</span><span class="s2">&quot;euclidean&quot;</span><span class="p">,</span> <span class="n">linkage</span><span class="o">=</span><span class="s2">&quot;complete&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">fa</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">pcs</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">random_cluster</span> <span class="o">=</span> <span class="mi">106</span>
<span class="n">idxs</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">label</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">fa</span><span class="o">.</span><span class="n">labels_</span><span class="p">)</span> <span class="k">if</span> <span class="n">label</span><span class="o">==</span><span class="n">random_cluster</span><span class="p">]</span>

<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">idxs</span><span class="p">):</span>
    
    
    <span class="n">motifs</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">plot_logo</span><span class="p">(</span><span class="n">add_left</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./analysis"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        </div>
    </div>
    
    
    <div class='prev-next-bottom'>
        
    <a class='left-prev' id="prev-link" href="pcas.py.html" title="previous page">Principal Component Analysis of “differential” peaks</a>
    <a class='right-next' id="next-link" href="relative_cell.py.html" title="next page">Cell contribution</a>

    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By Maarten van der Sande, & Simon van Heeringen<br/>
        
            &copy; Copyright 2020.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>

    
  <script src="../_static/js/index.30270b6e4c972e43c488.js"></script>


    
  </body>
</html>